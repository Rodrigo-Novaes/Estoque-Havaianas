<!doctype html>
<html lang="pt-br" data-bs-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login - {% if empresa and empresa.nome_fantasia %}{{ empresa.nome_fantasia }}{% else %}Estoque Havaianas{% endif %}</title>

    <!-- Bootstrap 5 -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Bootstrap Icons -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"
    />

    <style>
      :root {
        --havaianas-blue: #0066cc;
        --havaianas-green: #00cc66;
      }

      body {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0;
        padding: 20px;
      }

      .login-container {
        max-width: 450px;
        width: 100%;
      }

      .login-card {
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
        overflow: hidden;
      }

      .login-header {
        background: linear-gradient(135deg, #0066cc, #00cc66);
        padding: 40px 30px 30px;
        text-align: center;
        color: white;
      }

      .login-header .brand-icon {
        background: rgba(255, 255, 255, 0.2);
        width: 70px;
        height: 70px;
        border-radius: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 15px;
        font-size: 2.5rem;
      }

      /* ðŸ”¥ Estilo para a logo da empresa */
      .login-header .empresa-logo {
        max-width: 200px;
        max-height: 100px;
        margin: 0 auto 15px;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .login-header .empresa-logo img {
        max-width: 100%;
        max-height: 100px;
        width: auto;
        height: auto;
        object-fit: contain;
      }

      .login-header h2 {
        margin: 0;
        font-weight: 700;
        font-size: 1.8rem;
      }

      .login-header p {
        margin: 5px 0 0;
        opacity: 0.9;
        font-size: 0.9rem;
      }

      .login-body {
        padding: 40px 30px;
      }

      .form-floating {
        margin-bottom: 20px;
      }

      .form-floating input {
        border-radius: 12px;
        border: 2px solid #e9ecef;
        padding: 1rem 0.75rem;
        height: auto;
        transition: all 0.3s ease;
      }

      .form-floating input:focus {
        border-color: #0066cc;
        box-shadow: 0 0 0 0.2rem rgba(0, 102, 204, 0.1);
      }

      .form-floating label {
        padding: 1rem 0.75rem;
        color: #6c757d;
      }

      .password-toggle {
        position: absolute;
        right: 15px;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        color: #adb5bd;
        cursor: pointer;
        z-index: 20;
        padding: 5px;
      }

      .password-toggle:hover {
        color: #0066cc;
      }

      .form-check {
        margin: 20px 0;
      }

      .form-check-input:checked {
        background-color: #0066cc;
        border-color: #0066cc;
      }

      .btn-login {
        background: linear-gradient(135deg, #0066cc, #00cc66);
        border: none;
        border-radius: 12px;
        padding: 14px;
        font-weight: 600;
        font-size: 1rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        color: white;
        width: 100%;
        transition: all 0.3s ease;
        margin-bottom: 15px;
      }

      .btn-login:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(0, 102, 204, 0.3);
      }

      /* Estilo para mensagens flash */
      .flash-message {
        position: fixed;
        right: 20px;
        top: 80px;
        z-index: 9999;
        max-width: 350px;
        min-width: 300px;
        padding: 12px 15px;
        margin-bottom: 10px;
        font-size: 0.9em;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        border-left: 4px solid;
        display: flex;
        align-items: center;
        justify-content: space-between;
        opacity: 1;
        transform: none;
      }

      .flash-success {
        background-color: #d1e7dd;
        border-color: #badbcc;
        color: #0f5132;
        border-left-color: #198754;
      }

      .flash-danger,
      .flash-error {
        background-color: #f8d7da;
        border-color: #f5c2c7;
        color: #842029;
        border-left-color: #dc3545;
      }

      .flash-warning {
        background-color: #fff3cd;
        border-color: #ffecb5;
        color: #664d03;
        border-left-color: #ffc107;
      }

      .flash-info {
        background-color: #cff4fc;
        border-color: #b6effb;
        color: #055160;
        border-left-color: #0dcaf0;
      }

      .flash-close-btn {
        background: none;
        border: none;
        color: inherit;
        opacity: 0.7;
        cursor: pointer;
        padding: 0;
        margin-left: 10px;
        font-size: 1.1em;
      }

      .flash-close-btn:hover {
        opacity: 1;
      }

      .flash-icon {
        margin-right: 8px;
        font-size: 1.1em;
      }

      .footer-links {
        text-align: center;
        margin-top: 25px;
      }

      .footer-links a {
        color: rgba(255, 255, 255, 0.8);
        text-decoration: none;
        font-size: 0.85rem;
        margin: 0 10px;
        transition: color 0.3s ease;
      }

      .footer-links a:hover {
        color: white;
      }

      @media (max-width: 576px) {
        .login-header {
          padding: 30px 20px 20px;
        }
        .login-body {
          padding: 30px 20px;
        }
        .login-header h2 {
          font-size: 1.5rem;
        }
        .flash-message {
          right: 10px;
          left: 10px;
          max-width: calc(100% - 20px);
        }
      }
    </style>
  </head>
  <body>
    <div class="login-container">
      <div class="login-card">
        <!-- Header com logo da empresa -->
        <div class="login-header">
          {% if empresa and empresa.logo_login %}
          <!-- ðŸ”¥ LOGO PERSONALIZADA DA EMPRESA -->
          <div class="empresa-logo">
            <!-- ðŸ”¥ ÃšNICA LINHA ALTERADA: uploaded_file â†’ uploaded_logo -->
            <img src="{{ url_for('uploaded_logo', filename=empresa.logo_login) }}" 
                 alt="{{ empresa.nome_fantasia or 'Havaianas' }}">
          </div>
          {% else %}
          <!-- ðŸ”¥ LOGO PADRÃƒO (FALLBACK) -->
          <div class="brand-icon">
            <i class="bi bi-shop"></i>
          </div>
          {% endif %}
          
          <!-- ðŸ”¥ NOME DA EMPRESA (APENAS NOME FANTASIA) -->
          <h2 style="font-family: '{{ empresa.fonte_login_familia or 'Segoe UI' }}'; 
           font-size: {{ empresa.fonte_login_tamanho or 28 }}px;
           color: {{ empresa.fonte_login_cor or '#ffffff' }};">
              {{ empresa.nome_fantasia or 'HAVAIANAS STORE' }}
          </h2>
        </div>

        <!-- Corpo do login -->
        <div class="login-body">
          <!-- Flash messages - vindo da rota -->
          <div id="flash-area">
            {% with messages = get_flashed_messages(with_categories=true) %}
              {% if messages %}
                {% for category, message in messages %}
                  {% set flash_class = 'flash-' + ('danger' if category == 'error' else category) %}
                  {% set flash_icon = '' %}
                  {% if category == 'success' %}
                    {% set flash_icon = 'bi-check-circle-fill' %}
                  {% elif category == 'danger' or category == 'error' %}
                    {% set flash_icon = 'bi-exclamation-triangle-fill' %}
                  {% elif category == 'warning' %}
                    {% set flash_icon = 'bi-exclamation-circle-fill' %}
                  {% else %}
                    {% set flash_icon = 'bi-info-circle-fill' %}
                  {% endif %}

                  <div class="flash-message {{ flash_class }}" id="flash-{{ loop.index }}">
                    <div style="display: flex; align-items: center">
                      <i class="bi {{ flash_icon }} flash-icon"></i>
                      <span>{{ message }}</span>
                    </div>
                    <button
                      type="button"
                      class="flash-close-btn"
                      onclick="this.parentElement.remove()"
                    >
                      <i class="bi bi-x"></i>
                    </button>
                  </div>
                {% endfor %}
              {% endif %}
            {% endwith %}
          </div>

          <!-- FormulÃ¡rio de login -->
          <form method="POST" action="{{ url_for('login') }}" id="loginForm">
            <div class="form-floating">
              <input
                type="text"
                class="form-control"
                id="username"
                name="username"
                placeholder="UsuÃ¡rio"
                required
                autofocus
                autocomplete="off"
              />
              <label for="username"
                ><i class="bi bi-person me-2"></i>UsuÃ¡rio</label
              >
            </div>

            <div class="form-floating position-relative">
              <input
                type="password"
                class="form-control"
                id="password"
                name="password"
                placeholder="Senha"
                required
              />
              <label for="password"><i class="bi bi-lock me-2"></i>Senha</label>
              <button type="button" class="password-toggle" id="togglePassword">
                <i class="bi bi-eye"></i>
              </button>
            </div>

            <div class="d-flex justify-content-between align-items-center">
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="rememberMe"
                  name="remember"
                />
                <label class="form-check-label" for="rememberMe">
                  Lembrar-me
                </label>
              </div>
              <a
                href="#"
                class="text-decoration-none"
                style="color: #0066cc; font-size: 0.9rem"
                >Esqueceu a senha?</a
              >
            </div>

            <button type="submit" class="btn-login" id="btnLogin">
              <span>Entrar</span>
              <i class="bi bi-arrow-right ms-2"></i>
            </button>
          </form>
        </div>
      </div>

      <!-- VersÃ£o do sistema com nome da empresa -->
      <div
        class="text-center mt-3"
        style="color: rgba(255, 255, 255, 0.6); font-size: 0.8rem"
      >
        <i class="bi bi-shield-check me-1"></i>
        VersÃ£o 1.0.0 | Â© 2024 {{ empresa.nome_fantasia or 'Havaianas Store' }}
      </div>
    </div>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      // Mostrar/ocultar senha
      $("#togglePassword").click(function () {
        const passwordInput = $("#password");
        const icon = $(this).find("i");

        if (passwordInput.attr("type") === "password") {
          passwordInput.attr("type", "text");
          icon.removeClass("bi-eye").addClass("bi-eye-slash");
        } else {
          passwordInput.attr("type", "password");
          icon.removeClass("bi-eye-slash").addClass("bi-eye");
        }
      });

      // Auto-fechar flash messages apÃ³s 3 segundos
      document.addEventListener("DOMContentLoaded", function () {
        document.querySelectorAll(".flash-message").forEach((message) => {
          setTimeout(() => {
            if (message.parentNode) {
              message.remove();
            }
          }, 3000);
        });
      });

      // Efeito de loading no submit
      $("#loginForm").submit(function () {
        const btn = $("#btnLogin");
        btn
          .html(
            '<span class="spinner-border spinner-border-sm me-2"></span>Entrando...',
          )
          .prop("disabled", true);
      });
    </script>
  </body>
</html>